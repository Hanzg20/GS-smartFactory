# 智能工厂平台需求文档

---

## 1. 项目背景与目标
- 本系统旨在为中小制造企业提供一站式、易用、可扩展的智能工厂数字化平台。
- 核心目标：提升生产透明度、效率与质量，降低管理和运维门槛。

---

## 2. 用户与角色体系
| 角色         | 主要诉求/关注点                  | 典型操作           |
|--------------|----------------------------------|--------------------|
| 老板/高管     | 全局KPI、异常、利润、趋势         | 查看大屏/报表      |
| 生产主管     | 生产进度、工单、排班、异常         | 工单管理、排班     |
| 设备工程师   | 设备状态、报警、维保、能耗         | 设备维护、报警处理 |
| 质量管理     | 质量检测、异常、追溯               | 检测、异常处理     |
| 仓库管理员   | 库存、物料流转、预警               | 出入库、盘点       |
| 操作员       | 工单、设备、操作指引               | 工单执行、报修     |
| 大屏         | 全局只读、实时监控                 | 只读展示           |

---

## 3. 功能模块与分类（人/机/料/法/环/测）
| 维度 | 主要功能模块（举例）         |
|------|-----------------------------|
| 人   | 人员管理、排班、操作记录     |
| 机   | 设备管理、报警、维保、OEE    |
| 料   | 物料台账、库存、批次追溯     |
| 法   | 工艺参数、作业指导书         |
| 环   | 环境监测、能耗分析           |
| 测   | 质量检测、异常、追溯         |

---

## 4. 业务流程与数据流
- 关键流程图（如工单流转、报警处理、物料出入库、质量追溯等，建议后续补充流程图）
- 数据流向：设备数据→报警→工单→维保→追溯

---

## 5. 界面与交互原则
- 首页/大屏：六大要素分区卡片，突出KPI和异常，点击可钻取。
- 菜单/导航：按六大要素分区，二级菜单为具体功能。
- 差异化展示：不同角色首页和菜单内容不同，只显示最相关内容。
- 移动端适配：核心功能移动端可用，支持扫码、拍照等操作。

---

## 6. 权限与安全策略
- 权限模型：RBAC（基于角色的访问控制），每个角色对应可访问的功能和数据范围。
- 数据隔离：不同工厂/车间/班组数据隔离，防止越权。
- 大屏/只读账号：只读权限、全局可见、无操作入口、可配置展示内容。

---

## 7. 配置与可扩展性
- 自定义项：首页卡片、报表、看板、工艺参数等支持自定义。
- 扩展机制：支持后续增加新功能、角色、业务线，接口标准化。

---

## 8. 技术与集成要求
- 对接能力：支持与主流ERP/MES/WMS等系统集成，API标准化。
- 部署方式：支持本地/云端/混合部署。
- 运维保障：自动备份、日志、健康监控、异常告警。

---

## 9. 交付与上线计划
- 版本规划：MVP、V1.0、V2.0等，每阶段核心目标简明列出。
- 验收标准：每个功能点的可验收条件（如“工单可下发、可追溯、可完工”）。

---

## 10. 附录
- 术语表：对专业名词、缩写做简明解释。
- 参考资料：业界最佳实践、竞品分析、标准文档等。 

## 🏗️ 当前项目目录结构

### 📁 根目录层级
```
GS-smartFactory/
├── 📁 frontend/                 # 前端应用
├── 📁 backend/                  # 后端API服务
├── 📁 core/                     # Goldsky Core核心模块
├── 📁 plugins/                  # 插件系统
├── 📁 docs/                     # 项目文档
├── 📁 scripts/                  # 构建和部署脚本
├── 📁 goldsky-core-demo/        # Core演示
├── 📄 package.json              # 项目根package配置
├── 📄 docker-compose.yml        # 容器编排配置
├── 📄 supabase-setup.sql        # 数据库初始化脚本
└── 📄 README.md                 # 项目说明文档
```

### 🎨 前端目录结构 (`frontend/`)
```
frontend/
├── 📁 src/
│   ├── 📁 components/           # React组件
│   │   ├── 📁 base/            # 基础UI组件
│   │   ├── 📄 Layout.tsx       # 布局组件
│   │   ├── 📄 Navigation.tsx   # 导航组件
│   │   ├── 📄 LoginForm.tsx    # 登录表单
│   │   ├── 📄 DeviceList.tsx   # 设备列表
│   │   ├── 📄 FactoryOverview.tsx # 工厂概览
│   │   ├── 📄 BigScreenDashboard.tsx # 大屏仪表板
│   │   ├── 📄 AIAnalysis.tsx   # AI分析
│   │   ├── 📄 Reports.tsx      # 报表组件
│   │   └── 📄 ...其他页面组件
│   ├── 📁 stores/              # Zustand状态管理
│   │   ├── 📄 auth-store.ts    # 认证状态
│   │   └── 📄 device-store.ts  # 设备状态
│   ├── 📁 hooks/               # 自定义React Hooks
│   ├── 📁 lib/                 # 工具库和API客户端
│   ├── 📁 types/               # TypeScript类型定义
│   ├── 📁 contexts/            # React Context
│   ├── 📁 utils/               # 工具函数
│   ├── 📁 stories/             # Storybook组件故事
│   ├── 📄 App.tsx              # 主应用组件
│   └── 📄 main.tsx             # 应用入口
├── 📁 public/                  # 静态资源
├── 📄 package.json             # 前端依赖配置
├── 📄 vite.config.ts           # Vite构建配置
├── 📄 tailwind.config.js       # Tailwind CSS配置
└── 📄 Dockerfile               # 前端容器化配置
```

### ⚙️ 后端目录结构 (`backend/`)
```
backend/
├── 📁 src/
│   ├── 📁 controllers/         # 业务控制器
│   │   ├── 📄 enterprise-controller.js # 企业管理
│   │   ├── 📄 device-controller.js     # 设备管理
│   │   ├── 📄 alarm-controller.js      # 报警管理
│   │   ├── 📄 production-controller.js # 生产管理
│   │   ├── 📄 maintenance-controller.js # 维护管理
│   │   ├── 📄 ai-controller.js         # AI分析
│   │   └── 📄 report-controller.js     # 报表管理
│   ├── 📁 routes/              # API路由定义
│   │   ├── 📄 index.js         # 主路由
│   │   ├── 📄 alarm-routes.js  # 报警路由
│   │   ├── 📄 production-routes.js # 生产路由
│   │   └── 📄 ...其他路由
│   ├── 📁 middleware/          # 中间件
│   │   ├── 📄 auth.js          # 认证中间件
│   │   ├── 📄 cache.js         # 缓存中间件
│   │   └── 📄 monitoring.js    # 监控中间件
│   ├── 📁 services/            # 业务服务层
│   │   ├── 📄 workshop-service.js # 车间服务
│   │   └── 📄 supabase-service.js # 数据库服务
│   ├── 📁 config/              # 配置文件
│   │   └── 📄 database.js      # 数据库配置
│   ├── 📁 socket/              # WebSocket处理
│   │   └── 📄 socket-handlers.js
│   └── 📄 index.js             # 服务器入口
├── 📄 package.json             # 后端依赖配置
└── 📄 Dockerfile               # 后端容器化配置
```

### 🔧 Goldsky Core目录结构 (`core/`)
```
core/
├── auth/                    # 认证与授权
├── config/                  # 配置管理
├── data/                    # 数据管理  
├── workflow/                # 工作流引擎
├── reporting/               # 报表与分析
├── file/                    # 文件管理
├── communication/           # 通信与集成
├── monitoring/              # 监控与日志
├── security/                # 安全与合规
├── performance/             # 缓存与性能
├── plugin/                  # 插件系统 ✅
└── types/                   # 核心类型 ✅
```

### 🔌 插件目录结构 (`plugins/`)
```
plugins/
└── 📁 factory/                 # 工厂插件
    └── 📄 FactoryPlugin.ts     # 工厂插件实现
```

### 📚 文档目录结构 (`docs/`)
```
docs/
├── 📄 SYSTEM_DESIGN.md         # 系统设计文档
├── 📄 development.md           # 开发指南
├── 📄 Database-Architecture.md # 数据库架构
├── 📄 Development-Plan.md      # 开发计划
├── 📄 deployment.md            # 部署指南
├── 📄 需求文档.md              # 需求文档
└── 📄 supabase-setup.sql       # 数据库设置脚本
```

## 🎯 目录划分的设计原则

### 1. **分层架构**
- **表现层**: `frontend/src/components/` - React组件
- **业务逻辑层**: `backend/src/controllers/` 和 `core/services/`
- **数据访问层**: `backend/src/config/` 和 `core/services/`
- **插件层**: `plugins/` - 领域特定功能

### 2. **模块化设计**
- **核心模块** (`core/`): 通用功能和抽象层
  - **认证模块**: 用户登录、权限验证、会话管理
  - **配置模块**: 系统配置、界面配置、地区配置
  - **实体模块**: 通用实体抽象和服务
  - **插件模块**: 插件管理和生命周期
- **插件模块** (`plugins/`): 领域特定功能
- **前端模块** (`frontend/`): 用户界面层
- **后端模块** (`backend/`): API服务层

### 3. **功能分组**
- **按功能域划分**: 设备、报警、生产、维护等
- **按技术层次划分**: 组件、服务、工具、类型等
- **按使用场景划分**: 基础组件、业务组件、页面组件等

### 4. **通用功能模块** (`core/services/`)
- **AuthService**: 
  - 用户登录、注册、登出
  - JWT令牌管理和验证
  - 权限检查和角色管理
  - 会话管理和安全控制
- **ConfigurationService**: 
  - 系统级配置管理
  - 动态配置热更新
  - 配置版本控制
- **UIConfigurationService**: 
  - 界面主题配置
  - 菜单和组件配置
  - 个人偏好设置
  - 多级配置继承（全局→租户→角色→用户）
- **RegionService**: 
  - 地区数据管理
  - 时区和本地化支持
  - 层级地区结构
- **TenantService**: 
  - 多租户管理
  - 租户隔离和权限
  - 域名和slug管理

### 5. **可扩展性考虑**
- **插件系统**: 支持新领域（零售、农业等）的快速接入
- **核心抽象**: 通用实体和服务模型
- **配置驱动**: 通过配置文件支持不同部署环境
- **权限体系**: 支持细粒度的功能和数据权限控制
- **多租户架构**: 支持SaaS模式的多客户部署
- **国际化支持**: 支持多语言、多时区、多货币

### 6. **核心功能特点**
- **即插即用**: 新增智慧领域只需开发对应插件
- **安全优先**: 完善的认证、授权和审计机制
- **配置灵活**: 支持运行时动态配置修改
- **用户体验**: 个性化界面配置和偏好设置
- **全球化支持**: 多地区部署和本地化适配

这种目录结构既保持了当前工厂管理系统的完整性，又为未来扩展到其他智慧领域（如智慧零售、智慧农业等）奠定了良好的架构基础。通过Goldsky Core的通用功能模块，新的智慧应用可以专注于业务逻辑实现，而无需重复开发基础功能。 

## 🏗️ Goldsky Core 核心功能模块重新梳理

根据最佳实践，我将按照**通用性**、**复用性**和**业务价值**重新整理核心模块：

### ✅ **第一层：基础设施核心模块** (Infrastructure Core)
这些是所有智慧应用都必须具备的基础能力：

#### 1. **认证与授权** (Authentication & Authorization)
- **用户管理**: 用户注册、登录、登出、密码管理
- **身份验证**: JWT令牌、多因子认证、会话管理  
- **权限控制**: 基于角色的访问控制(RBAC)、资源权限、数据权限
- **多租户**: 租户隔离、成员管理、订阅管理

#### 2. **配置管理** (Configuration Management)
- **系统配置**: 动态配置、环境变量、功能开关
- **界面配置**: 主题、布局、菜单、组件配置
- **地区配置**: 多语言、时区、货币、本地化
- **业务配置**: 工作流程、业务规则、审批流程

#### 3. **数据管理** (Data Management)
- **数据访问**: 统一的数据访问层、CRUD操作
- **数据校验**: 输入验证、业务规则验证、数据完整性
- **数据同步**: 实时同步、批量同步、冲突解决
- **数据导入导出**: 批量导入、数据导出、格式转换

#### 4. **通信与集成** (Communication & Integration)
- **API网关**: 路由、限流、熔断、监控
- **消息队列**: 异步处理、事件驱动、任务调度
- **第三方集成**: 支付、短信、邮件、推送通知
- **Webhook**: 事件回调、数据同步、状态通知

### ✅ **第二层：业务支撑核心模块** (Business Support Core)

#### 5. **工作流引擎** (Workflow Engine)
- **流程定义**: 可视化流程设计、条件分支、并行处理
- **流程执行**: 任务分配、状态跟踪、超时处理
- **表单引擎**: 动态表单、字段验证、数据收集
- **审批管理**: 多级审批、委托审批、审批历史

#### 6. **报表与分析** (Reporting & Analytics)
- **报表引擎**: 报表设计、数据展示、导出功能
- **仪表板**: 可配置仪表板、实时数据、图表组件
- **数据分析**: 统计分析、趋势分析、预警机制
- **业务智能**: 多维分析、数据挖掘、决策支持

#### 7. **文件管理** (File Management)
- **文件存储**: 本地存储、云存储、分布式存储
- **文件处理**: 上传下载、格式转换、缩略图生成
- **文档管理**: 版本控制、权限管理、搜索功能
- **媒体处理**: 图片处理、视频处理、音频处理

### ✅ **第三层：运维支撑核心模块** (Operations Support Core)

#### 8. **监控与日志** (Monitoring & Logging)
- **系统监控**: 性能监控、资源监控、健康检查
- **业务监控**: 关键指标、异常告警、趋势分析
- **日志管理**: 日志收集、日志分析、日志存储
- **链路追踪**: 请求追踪、性能分析、错误定位

#### 9. **安全与合规** (Security & Compliance)
- **数据加密**: 传输加密、存储加密、密钥管理
- **安全审计**: 操作日志、安全事件、合规报告
- **访问控制**: IP白名单、设备管理、会话控制
- **数据保护**: 数据脱敏、备份恢复、隐私保护

#### 10. **缓存与性能** (Caching & Performance)
- **多级缓存**: 应用缓存、数据库缓存、分布式缓存
- **性能优化**: 查询优化、资源压缩、CDN加速
- **负载均衡**: 请求分发、健康检查、故障转移
- **资源管理**: 连接池、线程池、内存管理

### 🔄 **插件扩展层** (Plugin Extension Layer)

#### 11. **插件系统** (Plugin System)
- **插件管理**: 安装、卸载、启用、禁用
- **依赖管理**: 版本控制、依赖检查、自动更新
- **扩展点**: 业务扩展、UI扩展、数据扩展
- **生命周期**: 初始化、运行时、清理、错误处理

### ❌ **不应该在Core中的功能**

以下功能**不应该**放在Core中，而应该作为插件或应用层实现：

1. **具体业务逻辑**: 设备管理、生产管理、销售管理等
2. **特定行业功能**: 工厂管理、农业管理、零售管理等  
3. **具体UI组件**: 设备列表、生产图表、订单表单等
4. **第三方服务**: 具体的支付接口、具体的短信服务等
5. **业务数据模型**: 产品、订单、库存等业务实体

### 📊 **优先级排序** (按业务价值和通用性)

**高优先级** (立即实现):
1. 认证与授权 ✅ (已实现)
2. 配置管理 ✅ (已实现)  
3. 数据管理 ✅ (已实现)
4. 插件系统 ✅ (已实现)

**中优先级** (第二期实现):
5. 工作流引擎
6. 报表与分析
7. 监控与日志
8. 文件管理

**低优先级** (第三期实现):
9. 通信与集成
10. 安全与合规
11. 缓存与性能

### 🎯 **重新梳理后的目录结构**

```
core/
├── auth/                    # 认证与授权
├── config/                  # 配置管理
├── data/                    # 数据管理  
├── workflow/                # 工作流引擎
├── reporting/               # 报表与分析
├── file/                    # 文件管理
├── communication/           # 通信与集成
├── monitoring/              # 监控与日志
├── security/                # 安全与合规
├── performance/             # 缓存与性能
├── plugin/                  # 插件系统 ✅
└── types/                   # 核心类型 ✅
```

这样重新梳理后，Goldsky Core将成为一个真正的**企业级应用开发平台**，提供所有智慧应用都需要的通用功能，而具体的业务逻辑则通过插件系统来扩展。这样既保证了核心的通用性，又具备了足够的扩展能力。 